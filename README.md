# causality
[![Build Status](https://travis-ci.org/sa-adebayo/causality.svg?branch=master)](https://travis-ci.org/sa-adebayo/causality)
[![Build status](https://ci.appveyor.com/api/projects/status/i89ygpvpdl8wpqjr/branch/master?svg=true)](https://ci.appveyor.com/project/sa-adebayo/causality/branch/master)

**causality** is a direct fork from [fswatch](http://github.com/codeskyblue/fswatch). Special props to [codeskyblue](http://github.com/codeskyblue) for making [fswatch](http://github.com/codeskyblue/fswatch) so awesome that I cannot resist making it more awesome and fitting for my needs and others as well.

The intent is to improve on it, make it an artifact executable on various platform with more configuration right from initialization.

**causality** is a developer tool that triggers commands in response to filesystem changes.
Works well on Mac, Linux, and should also works on Windows(not well tested).

## Install

```golang
go get -u -v github.com/sa-adebayo/causality
```

## Quick start

### Step 1

Create a config file `.fsw.yml`, quickly generated by the following command.

```bash
  causality init
```

config file example

```yaml
desc: Auto generated by causality [artifact-monit]
triggers:
- name: "artifact-monit"
- pattens:
  - '**/*.go'
  - '**/*.c'
  - '!**/test_*.go' # also supports a negated path (ignore)
  env:
    DEBUG: "1"
  shell: true # $cmd will be wrapped with `bash -c`
  cmd: go test -v
  delay: 100ms
  stop_timeout: 1s
  signal: "KILL"
  kill_signal: "SIGTERM"
watch_paths:
- .
watch_depth: 5
```

### Step 2

Run `causality` directly.
Every time you edit a file. Command `go test -v` will be called.

```shell
$ causality
causality >>> exec start: go test -v
# github.com/sa-adebayo/causality
./causality.go:281: main redeclared in this block
  previous declaration at ./config.go:354
causality >>> program exited: exit status 2
causality >>> finish in 145.499911ms
```

## You should know

### How causality kill process

**causality** send signal to all process when restart. (mac and linux killed by pgid, windows by taskkill)
`Ctrl+C` will trigger **causality** quit and kill all process it started.

### Pattens

More about the pattens. The patten has the same rule like `.gitignore`.
So you can write like this.

```yaml
- pattens:
  - '*.go'
  - '!*_test.go'
  - '!**/bindata.go'
  - './c-artifact'
```

`main.go`and `c-artifact` changes will trigger command `go test -v`, but `a_test.go` and `libs/bindata.go` will be ignored.

## FAQs

`too many open files`

For mac, run the following command

    sysctl -w kern.maxfiles=20480
    sysctl -w kern.maxfilesperproc=18000
    ulimit -S -n 2048

[reference](http://superuser.com/questions/433746/is-there-a-fix-for-the-too-many-open-files-in-system-error-on-os-x-10-7-1)

## Other

Chinese Blog: <http://my.oschina.net/goskyblue/blog/194240>

## Friendly link: 

* [bee](https://github.com/astaxie/bee)
* [fsnotify](github.com/go-fsnotify/fsnotify)
* [fswatch](http://github.com/codeskyblue/fswatch)
* <https://github.com/codeskyblue/kexec>
* <https://github.com/codeskyblue/dockerignore>

## Code History

I forked the 2.0 version of [fswatch](http://github.com/codeskyblue/fswatch). I reviewed and refactored what I saw. Added a little codes to make it fit around my need.

## Alternative

* <https://github.com/cortesi/modd>
* <http://github.com/codeskyblue/fswatch> fswatch
* <https://github.com/emcrisostomo/fswatch> write with cpp
* <https://github.com/Unknwon/bra> Funny name.

## LICENSE

Under [MIT](LICENSE)
